<meta charset='utf-8'>
<script src='http://code.jquery.com/jquery-latest.js'></script>
<script src='multitouch.js'></script>
<script src='bezier.js'></script>
<script src='polymath.js'></script>
<script src='historyconsumer.js'></script>
<script src='mergebuffer.js'></script>
<script src='whiteboard.js'></script>
<script src='socket.io/socket.io.js'></script>
<script>



$(function(){
  $("canvas").each(function(){
    $(this).wb();
    var $el=$(this)
    var delayBuffer=[]
    function delay(data){
      delayBuffer.push(data);
      setTimeout(function(){
        var data=delayBuffer.shift();
        $el.wbOnData(data);
      },1000*Math.random());
    }
    ws=io.connect('http://'+location.hostname+':3333');
    ws.on('init',function(data){
      $el.wbOnInit(data);
    })
    ws.on('data',function(data){
      //delay(data);
      $el.wbOnData(data);
    });
    $el.on('send',function(e,data){ws.emit('data',data);})



  });
})
</script>
<style>
canvas{position:absolute;left:0;top:0;background:#eee;}
#tools{position:fixed;left:10px;top:10px;height:0;}
#tools div{
  background:white;color:gray;
  display:inline-block;
  padding:4px 16px;
  margin: 0 8px;
  border-radius:4px;
  box-shadow:0 0 2px gray;
}

#tools.draw #draw, #tools.erase #erase, #tools.move #move{
  background:gray;
  color:white;
}
#tools div.button:hover{
  background:silver;
  color:white;
}
#tools div.button:active{
  background:gray;
  color:white;
}

button, input{font-size:16px;}
</style>
<canvas style='position:absolute;left:0;top:0;background:#eee;' width=400 height=400></canvas>
<div id='tools' class='draw'>
  <div id='draw' onclick="$('canvas').wbSetMode('draw')">Draw</div>
  <div id='move' onclick="$('canvas').wbSetMode('move')">Move</div>
  <div id='erase' onclick="$('canvas').wbSetMode('erase')">Erase</div>
  <div class='button' id='undo' onclick="$('canvas').wbUndo()">Undo</div>
  <div class='button' id='redo' onclick="$('canvas').wbRedo()">Redo</div>
  <div class='button' id='save' onclick="$('canvas').wbSave()">Save</div>
</div>
<canvas style='position:absolute;left:0;top:500;background:#eee;' width=400 height=400></canvas>